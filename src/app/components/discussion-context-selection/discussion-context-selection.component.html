<ion-header [translucent]="true">
  <ion-toolbar>
    <ion-buttons slot="start">
      <ion-back-button defaultHref="/home"></ion-back-button>
    </ion-buttons>
    <ion-title>Discussion - Choisir un contexte</ion-title>
  </ion-toolbar>
</ion-header>

<ion-content [fullscreen]="true">
  <div class="container">
    <!-- Conversation aléatoire -->
    <ion-card>
      <ion-card-header>
        <ion-card-title>Conversation aléatoire</ion-card-title>
        <ion-card-subtitle>
          Lance une conversation avec un contexte généré au hasard et 8 mots cibles à placer
        </ion-card-subtitle>
      </ion-card-header>
      <ion-card-content>
        <ion-button expand="block" color="primary" (click)="startRandomConversation()">
          <ion-icon name="shuffle-outline" slot="start"></ion-icon>
          Conversation aléatoire
        </ion-button>
      </ion-card-content>
    </ion-card>
    <ion-card>
      <ion-card-header>
        <ion-card-title>Mode Discussion</ion-card-title>
        <ion-card-subtitle>
          Choisissez un contexte pour commencer une conversation avec l'IA
        </ion-card-subtitle>
      </ion-card-header>
      <ion-card-content>
        <p>
          Dans ce mode, vous pouvez avoir une conversation naturelle en italien avec l'IA. 
          L'IA jouera un rôle spécifique selon le contexte choisi.
        </p>
      </ion-card-content>
    </ion-card>

    <!-- Bouton "Nouveau contexte" comme un item de la liste -->
    <ion-card>
      <ion-card-header>
        <ion-card-title>Créer un nouveau contexte</ion-card-title>
      </ion-card-header>
      <ion-card-content>
        <ion-list>
          <ion-item button (click)="openCreateContextModal()" class="context-item context-item-add">
            <ion-avatar slot="start">
              <ion-icon name="add-circle-outline" size="large" color="primary"></ion-icon>
            </ion-avatar>
            <ion-label>
              <h2>Créer un nouveau contexte</h2>
              <p>Définissez votre propre situation, votre rôle et celui de l'IA</p>
            </ion-label>
            <ion-icon slot="end" name="chevron-forward"></ion-icon>
          </ion-item>
        </ion-list>
      </ion-card-content>
    </ion-card>

    <!-- Accès aux conversations sauvegardées -->
    <ion-card>
      <ion-card-header>
        <ion-card-title>Conversations sauvegardées</ion-card-title>
      </ion-card-header>
      <ion-card-content>
        <ion-list>
          <ion-item button (click)="openSavedConversations()">
            <ion-icon name="chatbubbles-outline" slot="start" color="secondary"></ion-icon>
            <ion-label>Reprendre une conversation précédente</ion-label>
            <ion-icon slot="end" name="chevron-forward"></ion-icon>
          </ion-item>
        </ion-list>
      </ion-card-content>
    </ion-card>

    <!-- Filtres -->
    <ion-card>
      <ion-card-header>
        <ion-card-title>Filtres</ion-card-title>
      </ion-card-header>
      <ion-card-content>
        <ion-row>
          <ion-col size="6">
            <ion-label>Niveau</ion-label>
            <ion-select 
              [(ngModel)]="selectedDifficulty" 
              interface="popover"
              placeholder="Sélectionner un niveau">
              <ion-select-option 
                *ngFor="let difficulty of difficulties" 
                [value]="difficulty.value">
                {{ difficulty.label }}
              </ion-select-option>
            </ion-select>
          </ion-col>
          <ion-col size="6">
            <ion-label>Catégorie</ion-label>
            <ion-select 
              [(ngModel)]="selectedCategory" 
              interface="popover"
              placeholder="Sélectionner une catégorie">
              <ion-select-option value="all">Toutes les catégories</ion-select-option>
              <ion-select-option 
                *ngFor="let category of getCategories()" 
                [value]="category">
                {{ category }}
              </ion-select-option>
            </ion-select>
          </ion-col>
        </ion-row>
      </ion-card-content>
    </ion-card>

    <!-- Contextes de discussion -->
    <div *ngFor="let category of getFilteredContexts() | keyvalue">
      <ion-card>
        <ion-card-header>
          <ion-card-title>{{ category.key }}</ion-card-title>
        </ion-card-header>
        <ion-card-content>
          <ion-list>
            <ion-item 
              *ngFor="let context of category.value; let i = index" 
              button
              (click)="selectContext(context, i)"
              class="context-item">
              <ion-avatar slot="start">
                <ion-icon 
                  [name]="getContextIcon(context.id)" 
                  size="large"
                  [color]="getDifficultyColor(context.difficulty)">
                </ion-icon>
              </ion-avatar>
              <ion-label>
                <h2>{{ context.title }} <span style="font-size:0.8em;color:#888;">[id:{{context.id}}, idx:{{i}}]</span></h2>
                <p>{{ context.description }}</p>
                <ion-chip [color]="getDifficultyColor(context.difficulty)" size="small">
                  <ion-label>{{ getDifficultyLabel(context.difficulty) }}</ion-label>
                </ion-chip>
              </ion-label>
              <ion-icon slot="end" name="chevron-forward"></ion-icon>
            </ion-item>
          </ion-list>
        </ion-card-content>
      </ion-card>
    </div>

    <!-- Message si aucun contexte trouvé -->
    <ion-card *ngIf="isEmptyContexts()">
      <ion-card-content class="ion-text-center">
        <ion-icon name="search-outline" size="large" color="medium"></ion-icon>
        <h3>Aucun contexte trouvé</h3>
        <p>Essayez de modifier les filtres pour voir plus de résultats.</p>
      </ion-card-content>
    </ion-card>
  </div>
  <ion-fab vertical="bottom" horizontal="end" slot="fixed">
    <ion-fab-button color="primary" (click)="openCreateContextModal()">
      <ion-icon name="add"></ion-icon>
    </ion-fab-button>
  </ion-fab>
</ion-content> 
