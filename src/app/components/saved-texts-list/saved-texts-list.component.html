<!-- 
    <ion-header>
      <ion-toolbar>
        <ion-title>Mes textes sauvegardés</ion-title>
        <ion-buttons slot="start">
          <ion-button (click)="goHome()">Retour</ion-button>
        </ion-buttons>
      </ion-toolbar>
    </ion-header> -->

    <ion-content>
      <div class="ion-padding">
        <ion-searchbar [(ngModel)]="searchTerm" (ionInput)="filterTexts()" placeholder="Rechercher..."></ion-searchbar>
        <ion-segment [(ngModel)]="filterType" (ionChange)="filterTexts()">
          <ion-segment-button value="all">Tous</ion-segment-button>
          <ion-segment-button value="favorite">Favoris</ion-segment-button>
        </ion-segment>
        <div *ngIf="filteredTexts.length === 0" class="empty-list">Aucun texte sauvegardé.</div>
        <ion-list *ngIf="filteredTexts.length > 0">
          <ion-item *ngFor="let text of filteredTexts" (click)="selectText(text)">
            <ion-label>
              <h2>{{ text.title || 'Texte sans titre' }}</h2>
              <p>{{ text.dateCreated | date:'short' }}</p>
            </ion-label>
            <ion-button fill="clear" color="primary" (click)="toggleFavorite(text); $event.stopPropagation()">
              <ion-icon [name]="text.isFavorite ? 'star' : 'star-outline'"></ion-icon>
            </ion-button>
            <ion-button fill="clear" color="danger" (click)="deleteText(text); $event.stopPropagation()">
              <ion-icon name="trash"></ion-icon>
            </ion-button>
          </ion-item>
        </ion-list>
        <div class="stats" *ngIf="filteredTexts.length > 0">
          <p>Total : {{ filteredTexts.length }} | Favoris : {{ favoriteCount }}</p>
        </div>
      </div>

      <!-- Affichage du texte sélectionné avec mots cliquables -->
      <ion-modal [isOpen]="!!selectedText" [backdropDismiss]="true" (didDismiss)="closeTextModal()">
        <ng-template>
          <ion-header>
            <ion-toolbar color="primary">
              <ion-title>{{ selectedText?.title || 'Texte sauvegardé' }}</ion-title>
              <ion-buttons slot="end">
                <ion-button (click)="closeTextModal()">
                  <ion-icon name="close-outline"></ion-icon>
                </ion-button>
              </ion-buttons>
            </ion-toolbar>
          </ion-header>
          <ion-content class="ion-padding">
            <div [innerHTML]="getHighlightedText(selectedText) | safeHtml"
                 class="comprehension-text"
                 appSafeHtml
                 (wordClick)="onWordClicked($event, selectedText)"></div>
            <div *ngIf="selectedText && selectedFragment">
              <button class="translate-fixed-btn" (click)="translateSelection()">
                Traduire la sélection
              </button>
            </div>
            <div class="ion-padding-top ion-text-center">
              <ion-button (click)="generateAssociationSession()" color="secondary" [disabled]="isGeneratingSession">
                <!-- <ion-icon name="game-controller-outline" slot="start"></ion-icon> -->
                {{ isGeneratingSession ? 'Génération...' : 'Créer un exercice d\'association' }}
              </ion-button>
            </div>
          </ion-content>
        </ng-template>
      </ion-modal>

      <!-- Modal de traduction contextuelle -->
      <ion-modal [isOpen]="!!translation" [backdropDismiss]="true" (didDismiss)="closeTranslation()">
        <ng-template>
          <ion-header>
            <ion-toolbar color="primary">
              <ion-title>Traduction</ion-title>
              <ion-buttons slot="end">
                <ion-button (click)="closeTranslation()">
                  <ion-icon name="close-outline"></ion-icon>
                </ion-button>
              </ion-buttons>
            </ion-toolbar>
          </ion-header>
          <ion-content class="ion-padding">
            <div *ngIf="isTranslating" class="ion-text-center">
              <ion-spinner></ion-spinner>
              <p>Traduction en cours...</p>
            </div>
            <div *ngIf="translation && !isTranslating">
              <h2 class="ion-text-center">{{ translation.originalWord }}</h2>
              <ion-item lines="none">
                <ion-label>
                  <h3>Traduction</h3>
                  <p class="translation">{{ translation.translation }}</p>
                </ion-label>
              </ion-item>
              <ion-item lines="none">
                <ion-label>
                  <h3>Sens dans ce contexte</h3>
                  <p>{{ translation.contextualMeaning }}</p>
                </ion-label>
              </ion-item>
              <ion-item *ngIf="translation.partOfSpeech" lines="none">
                <ion-label>
                  <h3>Catégorie grammaticale</h3>
                  <p>{{ translation.partOfSpeech }}</p>
                </ion-label>
              </ion-item>
              <div *ngIf="translation.examples && translation.examples.length > 0" class="examples-section ion-padding-top">
                <h3>Exemples</h3>
                <ion-list>
                  <ion-item *ngFor="let example of translation.examples">
                    <ion-label text-wrap>{{ example }}</ion-label>
                  </ion-item>
                </ion-list>
              </div>
              <div class="ion-padding-top ion-text-center">
                <ion-button (click)="addWordToDictionary()" color="success" class="ion-margin-end">
                  <ion-icon name="add-circle-outline" slot="start"></ion-icon>
                  Ajouter au dictionnaire
                </ion-button>
                <ion-button (click)="closeTranslation()" color="medium">
                  Fermer
                </ion-button>
              </div>
            </div>
          </ion-content>
        </ng-template>
      </ion-modal>

      <div class="generated-sessions-section" *ngIf="generatedSessions.length > 0">
        <h3 class="ion-text-center">Sessions d'association générées</h3>
        <ion-list>
          <ion-item *ngFor="let session of generatedSessions">
            <ion-label>
              <h3>{{ session.title }}</h3>
              <p>{{ session.description || 'Session générée à partir d\'un texte sauvegardé' }}</p>
              <p class="session-meta">
                <ion-badge color="primary">{{ session.wordPairs.length }} mots</ion-badge>
                <ion-badge color="secondary">{{ session.difficulty }}</ion-badge>
                <span class="session-date">{{ session.createdAt | date:'short' }}</span>
              </p>
            </ion-label>
            <ion-button color="success" (click)="restartGeneratedSession(session.id)">
              <ion-icon name="play-outline" slot="start"></ion-icon>
              Rejouer
            </ion-button>
          </ion-item>
        </ion-list>
      </div>
    </ion-content>
  