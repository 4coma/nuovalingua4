w<ion-header>
  <ion-toolbar>
    <ion-buttons slot="start">
      <ion-button (click)="goHome()">
        <ion-icon name="arrow-back-outline"></ion-icon>
      </ion-button>
    </ion-buttons>
    <ion-title>Pr√©f√©rences</ion-title>
  </ion-toolbar>
</ion-header>

<ion-content class="ion-padding">
  <ion-card>
    <ion-card-header>
      <ion-card-title>
        <ion-icon name="key-outline" slot="start"></ion-icon>
        Cl√© API OpenAI
      </ion-card-title>
    </ion-card-header>
    <ion-card-content>
      <ion-text color="medium">
        <p>Une cl√© API open AI est n√©cessaire pour la g√©n√©ration des textes de compr√©hension √©crite et orale.</p>
      </ion-text>
      
      <ion-item>
        <ion-label position="stacked">Cl√© API OpenAI</ion-label>
        <ion-input 
          [(ngModel)]="openaiApiKey" 
          [type]="showApiKey ? 'text' : 'password'"
          placeholder="sk-..."
          class="api-key-input">
        </ion-input>
        <ion-button 
          fill="clear" 
          slot="end" 
          (click)="toggleApiKeyVisibility()">
          <ion-icon [name]="showApiKey ? 'eye-off-outline' : 'eye-outline'"></ion-icon>
        </ion-button>
      </ion-item>
      
      <ion-text color="medium" class="ion-padding-top">
        <p><small>Votre cl√© API est stock√©e localement sur votre appareil.</small></p>
      </ion-text>
      
      <ion-button fill="clear" color="primary" size="small" (click)="showApiKeyInfo()" class="ion-margin-top">
        <ion-icon name="information-circle-outline" slot="start"></ion-icon>
        Pourquoi configurer ma cl√© API ?
      </ion-button>
    </ion-card-content>
  </ion-card>

  <ion-card>
    <ion-card-header>
      <ion-card-title>
        <ion-icon name="volume-high-outline" slot="start"></ion-icon>
        Cl√© API Google Text-to-Speech
      </ion-card-title>
    </ion-card-header>
    <ion-card-content>
      <ion-text color="medium">
        <p>Entrez votre cl√© API Google Text-to-Speech pour activer la prononciation des mots italiens dans le jeu d'association.</p>
      </ion-text>
      
      <ion-item>  
        <ion-label position="stacked">Cl√© API Google TTS</ion-label>
        <ion-input 
          [(ngModel)]="googleTtsApiKey" 
          [type]="showGoogleApiKey ? 'text' : 'password'"
          placeholder="AIza..."
          class="api-key-input">
        </ion-input>
        <ion-button 
          fill="clear" 
          slot="end" 
          (click)="toggleGoogleApiKeyVisibility()">
          <ion-icon [name]="showGoogleApiKey ? 'eye-off-outline' : 'eye-outline'"></ion-icon>
        </ion-button>
      </ion-item>
      
      <ion-text color="medium" class="ion-padding-top">
        <p><small>Votre cl√© API est stock√©e localement sur votre appareil.</small></p>
      </ion-text>
      
      <ion-button fill="clear" color="primary" size="small" (click)="showGoogleApiKeyInfo()" class="ion-margin-top">
        <ion-icon name="information-circle-outline" slot="start"></ion-icon>
        Comment obtenir ma cl√© API Google TTS ?
      </ion-button>
    </ion-card-content>
  </ion-card>

  <ion-card>
    <ion-card-header>
      <ion-card-title>
        <ion-icon name="game-controller-outline" slot="start"></ion-icon>
        Nombre d'associations de mots
      </ion-card-title>
    </ion-card-header>
    <ion-card-content>
      <ion-text color="medium">
        <p>Choisissez le nombre de paires de mots g√©n√©r√©es lors du d√©marrage d'une session d'apprentissage.</p>
      </ion-text>
      
      <ion-item>
        <ion-label position="stacked">Nombre d'associations</ion-label>
        <ion-input 
          [(ngModel)]="wordAssociationsCount" 
          type="number" 
          min="1" 
          max="100"
          placeholder="Ex: 12"
          class="associations-input">
        </ion-input>
      </ion-item>
      
      <ion-text color="medium" class="ion-padding-top">
        <p><small>Saisissez le nombre exact d'associations souhait√©es (1-100).</small></p>
      </ion-text>
    </ion-card-content>
  </ion-card>

  <ion-card>
    <ion-card-header>
      <ion-card-title>
        <ion-icon name="mic-outline" slot="start"></ion-icon>
        Longueur des compr√©hensions orales
      </ion-card-title>
    </ion-card-header>
    <ion-card-content>
      <ion-text color="medium">
        <p>D√©finissez la longueur des textes g√©n√©r√©s pour les exercices de compr√©hension orale.</p>
      </ion-text>
      
      <ion-item>
        <ion-label position="stacked">Nombre de mots</ion-label>
        <ion-input 
          [(ngModel)]="oralComprehensionLength" 
          type="number" 
          min="50" 
          max="500"
          placeholder="Ex: 150"
          class="length-input">
        </ion-input>
      </ion-item>
      
      <ion-text color="medium" class="ion-padding-top">
        <p><small>Choisissez entre 50 et 500 mots pour adapter la dur√©e d'√©coute √† votre niveau (50-500 mots).</small></p>
      </ion-text>
    </ion-card-content>
  </ion-card>

  <ion-card>
    <ion-card-header>
      <ion-card-title>
        <ion-icon name="repeat-outline" slot="start"></ion-icon>
        M√©morisation espac√©e
      </ion-card-title>
    </ion-card-header>
    <ion-card-content>
      <ion-text color="medium">
        <p>D√©finissez le nombre de mots √† r√©viser lors d'une session de m√©morisation espac√©e.</p>
      </ion-text>
      
      <ion-item>
        <ion-label position="stacked">Nombre de mots par session</ion-label>
        <ion-input 
          [(ngModel)]="spacedRepetitionWordsCount" 
          type="number" 
          min="5" 
          max="50"
          placeholder="Ex: 10"
          class="spaced-repetition-input">
        </ion-input>
      </ion-item>
      
      <ion-text color="medium" class="ion-padding-top">
        <p><small>Choisissez entre 5 et 50 mots pour adapter la dur√©e de la session √† votre disponibilit√© (5-50 mots).</small></p>
      </ion-text>
    </ion-card-content>
  </ion-card>

  <ion-card>
    <ion-card-header>
      <ion-card-title>
        <ion-icon name="notifications-outline" slot="start"></ion-icon>
        Notifications quotidiennes
      </ion-card-title>
    </ion-card-header>
    <ion-card-content>
      <ion-text color="medium">
        <p>Recevez une notification quotidienne pour vous rappeler de pratiquer votre italien.</p>
      </ion-text>
      
      <ion-item>
        <ion-label>Activer les notifications quotidiennes</ion-label>
        <ion-toggle 
          [(ngModel)]="notificationsEnabled" 
          (ionChange)="onNotificationToggleChange()">
        </ion-toggle>
      </ion-item>
      
      <ion-item *ngIf="notificationsEnabled">
        <ion-label position="stacked">Heure de la notification</ion-label>
        <ion-input 
          [(ngModel)]="notificationTime" 
          type="time"
          (ionChange)="onNotificationTimeChange()">
        </ion-input>
      </ion-item>
      
      <ion-item *ngIf="notificationsEnabled">
        <ion-label position="stacked">Message de la notification</ion-label>
        <ion-textarea 
          [(ngModel)]="notificationMessage" 
          placeholder="Il est temps de pratiquer votre italien ! üáÆüáπ"
          rows="2"
          (ionChange)="onNotificationMessageChange()">
        </ion-textarea>
      </ion-item>
      
      <ion-button 
        *ngIf="notificationsEnabled"
        expand="block" 
        color="success" 
        (click)="sendTestNotification()"
        class="ion-margin-top">
        <ion-icon name="send-outline" slot="start"></ion-icon>
        Envoyer une notification de test
      </ion-button>
      
      <ion-button 
        expand="block" 
        color="warning" 
        fill="outline"
        (click)="checkNotificationPermissions()"
        class="ion-margin-top">
        <ion-icon name="shield-checkmark-outline" slot="start"></ion-icon>
        V√©rifier les permissions
      </ion-button>
      
      <ion-text color="medium" class="ion-padding-top">
        <p><small>La notification sera envoy√©e quotidiennement √† l'heure choisie pour vous rappeler de pratiquer.</small></p>
        <p><small><strong>Note :</strong> Sur Android 12+, vous devez autoriser les "Alarmes et rappels" dans les param√®tres syst√®me pour que les notifications exactes fonctionnent.</small></p>
      </ion-text>
    </ion-card-content>
  </ion-card>

  <ion-card>
    <ion-card-header>
      <ion-card-title>
        <ion-icon name="flask-outline" slot="start"></ion-icon>
        Test de l'algorithme SM-2
      </ion-card-title>
    </ion-card-header>
    <ion-card-content>
      <ion-text color="medium">
        <p>G√©n√©rez des mots de test et v√©rifiez comment l'algorithme SM-2 les s√©lectionne pour la m√©morisation espac√©e.</p>
      </ion-text>
      
      <ion-button 
        expand="block" 
        color="secondary" 
        (click)="generateTestWords()"
        class="ion-margin-bottom">
        <ion-icon name="add-circle-outline" slot="start"></ion-icon>
        G√©n√©rer 20 mots de test
      </ion-button>
      
      <ion-button 
        expand="block" 
        color="tertiary" 
        (click)="testSM2Algorithm()">
        <ion-icon name="analytics-outline" slot="start"></ion-icon>
        Tester l'algorithme SM-2
      </ion-button>
    </ion-card-content>
  </ion-card>

  <div class="ion-padding-top">
    <ion-button 
      expand="block" 
      color="primary" 
      (click)="savePreferences()"
      class="ion-margin-bottom">
      <ion-icon name="save-outline" slot="start"></ion-icon>
      Sauvegarder les pr√©f√©rences
    </ion-button>
    
    <ion-button 
      expand="block" 
      color="medium" 
      fill="outline"
      (click)="resetPreferences()">
      <ion-icon name="refresh-outline" slot="start"></ion-icon>
      R√©initialiser aux valeurs par d√©faut
    </ion-button>

    <ion-button 
      expand="block" 
      color="danger" 
      fill="outline"
      (click)="clearVocabulary()">
      <ion-icon name="trash-outline" slot="start"></ion-icon>
      Effacer tout le vocabulaire
    </ion-button>
  </div>
</ion-content> 