w<ion-header>
  <ion-toolbar>
    <ion-buttons slot="start">
      <ion-button (click)="goHome()">
        <ion-icon name="arrow-back-outline"></ion-icon>
      </ion-button>
    </ion-buttons>
    <ion-title>Préférences</ion-title>
  </ion-toolbar>
</ion-header>

<ion-content class="ion-padding">
  <ion-card>
    <ion-card-header>
      <ion-card-title>
        <ion-icon name="key-outline" slot="start"></ion-icon>
        Clé API OpenAI
      </ion-card-title>
    </ion-card-header>
    <ion-card-content>
      <ion-text color="medium">
        <p>Une clé API open AI est nécessaire pour la génération des textes de compréhension écrite et orale.</p>
      </ion-text>
      
      <ion-item>
        <ion-label position="stacked">Clé API OpenAI</ion-label>
        <ion-input 
          [(ngModel)]="openaiApiKey" 
          [type]="showApiKey ? 'text' : 'password'"
          placeholder="sk-..."
          class="api-key-input">
        </ion-input>
        <ion-button 
          fill="clear" 
          slot="end" 
          (click)="toggleApiKeyVisibility()">
          <ion-icon [name]="showApiKey ? 'eye-off-outline' : 'eye-outline'"></ion-icon>
        </ion-button>
      </ion-item>
      
      <ion-text color="medium" class="ion-padding-top">
        <p><small>Votre clé API est stockée localement sur votre appareil.</small></p>
      </ion-text>
      
      <ion-button fill="clear" color="primary" size="small" (click)="showApiKeyInfo()" class="ion-margin-top">
        <ion-icon name="information-circle-outline" slot="start"></ion-icon>
        Pourquoi configurer ma clé API ?
      </ion-button>
    </ion-card-content>
  </ion-card>

  <ion-card>
    <ion-card-header>
      <ion-card-title>
        <ion-icon name="volume-high-outline" slot="start"></ion-icon>
        Clé API Google Text-to-Speech
      </ion-card-title>
    </ion-card-header>
    <ion-card-content>
      <ion-text color="medium">
        <p>Entrez votre clé API Google Text-to-Speech pour activer la prononciation des mots italiens dans le jeu d'association.</p>
      </ion-text>
      
      <ion-item>  
        <ion-label position="stacked">Clé API Google TTS</ion-label>
        <ion-input 
          [(ngModel)]="googleTtsApiKey" 
          [type]="showGoogleApiKey ? 'text' : 'password'"
          placeholder="AIza..."
          class="api-key-input">
        </ion-input>
        <ion-button 
          fill="clear" 
          slot="end" 
          (click)="toggleGoogleApiKeyVisibility()">
          <ion-icon [name]="showGoogleApiKey ? 'eye-off-outline' : 'eye-outline'"></ion-icon>
        </ion-button>
      </ion-item>
      
      <ion-text color="medium" class="ion-padding-top">
        <p><small>Votre clé API est stockée localement sur votre appareil.</small></p>
      </ion-text>
      
      <ion-button fill="clear" color="primary" size="small" (click)="showGoogleApiKeyInfo()" class="ion-margin-top">
        <ion-icon name="information-circle-outline" slot="start"></ion-icon>
        Comment obtenir ma clé API Google TTS ?
      </ion-button>
    </ion-card-content>
  </ion-card>

  <ion-card>
    <ion-card-header>
      <ion-card-title>
        <ion-icon name="game-controller-outline" slot="start"></ion-icon>
        Nombre d'associations de mots
      </ion-card-title>
    </ion-card-header>
    <ion-card-content>
      <ion-text color="medium">
        <p>Choisissez le nombre de paires de mots générées lors du démarrage d'une session d'apprentissage.</p>
      </ion-text>
      
      <ion-item>
        <ion-label position="stacked">Nombre d'associations</ion-label>
        <ion-input 
          [(ngModel)]="wordAssociationsCount" 
          type="number" 
          min="1" 
          max="100"
          placeholder="Ex: 12"
          class="associations-input">
        </ion-input>
      </ion-item>
      
      <ion-text color="medium" class="ion-padding-top">
        <p><small>Saisissez le nombre exact d'associations souhaitées (1-100).</small></p>
      </ion-text>
    </ion-card-content>
  </ion-card>

  <ion-card>
    <ion-card-header>
      <ion-card-title>
        <ion-icon name="mic-outline" slot="start"></ion-icon>
        Longueur des compréhensions orales
      </ion-card-title>
    </ion-card-header>
    <ion-card-content>
      <ion-text color="medium">
        <p>Définissez la longueur des textes générés pour les exercices de compréhension orale.</p>
      </ion-text>
      
      <ion-item>
        <ion-label position="stacked">Nombre de mots</ion-label>
        <ion-input 
          [(ngModel)]="oralComprehensionLength" 
          type="number" 
          min="50" 
          max="500"
          placeholder="Ex: 150"
          class="length-input">
        </ion-input>
      </ion-item>
      
      <ion-text color="medium" class="ion-padding-top">
        <p><small>Choisissez entre 50 et 500 mots pour adapter la durée d'écoute à votre niveau (50-500 mots).</small></p>
      </ion-text>
    </ion-card-content>
  </ion-card>

  <ion-card>
    <ion-card-header>
      <ion-card-title>
        <ion-icon name="repeat-outline" slot="start"></ion-icon>
        Mémorisation espacée
      </ion-card-title>
    </ion-card-header>
    <ion-card-content>
      <ion-text color="medium">
        <p>Définissez le nombre de mots à réviser lors d'une session de mémorisation espacée.</p>
      </ion-text>
      
      <ion-item>
        <ion-label position="stacked">Nombre de mots par session</ion-label>
        <ion-input 
          [(ngModel)]="spacedRepetitionWordsCount" 
          type="number" 
          min="5" 
          max="50"
          placeholder="Ex: 10"
          class="spaced-repetition-input">
        </ion-input>
      </ion-item>
      
      <ion-text color="medium" class="ion-padding-top">
        <p><small>Choisissez entre 5 et 50 mots pour adapter la durée de la session à votre disponibilité (5-50 mots).</small></p>
      </ion-text>
    </ion-card-content>
  </ion-card>

  <ion-card>
    <ion-card-header>
      <ion-card-title>
        <ion-icon name="flask-outline" slot="start"></ion-icon>
        Test de l'algorithme SM-2
      </ion-card-title>
    </ion-card-header>
    <ion-card-content>
      <ion-text color="medium">
        <p>Générez des mots de test et vérifiez comment l'algorithme SM-2 les sélectionne pour la mémorisation espacée.</p>
      </ion-text>
      
      <ion-button 
        expand="block" 
        color="secondary" 
        (click)="generateTestWords()"
        class="ion-margin-bottom">
        <ion-icon name="add-circle-outline" slot="start"></ion-icon>
        Générer 20 mots de test
      </ion-button>
      
      <ion-button 
        expand="block" 
        color="tertiary" 
        (click)="testSM2Algorithm()">
        <ion-icon name="analytics-outline" slot="start"></ion-icon>
        Tester l'algorithme SM-2
      </ion-button>
    </ion-card-content>
  </ion-card>

  <div class="ion-padding-top">
    <ion-button 
      expand="block" 
      color="primary" 
      (click)="savePreferences()"
      class="ion-margin-bottom">
      <ion-icon name="save-outline" slot="start"></ion-icon>
      Sauvegarder les préférences
    </ion-button>
    
    <ion-button 
      expand="block" 
      color="medium" 
      fill="outline"
      (click)="resetPreferences()">
      <ion-icon name="refresh-outline" slot="start"></ion-icon>
      Réinitialiser aux valeurs par défaut
    </ion-button>

    <ion-button 
      expand="block" 
      color="danger" 
      fill="outline"
      (click)="clearVocabulary()">
      <ion-icon name="trash-outline" slot="start"></ion-icon>
      Effacer tout le vocabulaire
    </ion-button>
  </div>
</ion-content> 