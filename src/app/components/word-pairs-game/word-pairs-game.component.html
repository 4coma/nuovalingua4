<ion-content>
  <div class="container ion-padding">
    <!-- En-tête du jeu -->
    <div class="game-header ion-text-center">
      <h2 *ngIf="!gameComplete">
        <ion-icon name="link-outline"></ion-icon>
        Associez les mots
        <!-- Bouton mute/unmute -->
        <ion-button 
          fill="clear" 
          size="small" 
          (click)="toggleAudio()" 
          class="audio-toggle-btn">
          <ion-icon [name]="audioEnabled ? 'volume-high-outline' : 'volume-mute-outline'"></ion-icon>
        </ion-button>
      </h2>
      <h2 *ngIf="gameComplete">
        <ion-icon name="checkmark-circle-outline"></ion-icon>
        Bravo !
      </h2>
      
      <!-- Contrôle du nombre de paires (uniquement pour la révision du dictionnaire personnel) -->
      <div class="pairs-control" *ngIf="!gameComplete && isPersonalDictionaryRevision">
        <ion-item lines="none">
          <ion-label>Nombre de paires à réviser:</ion-label>
          <ion-select 
            [(ngModel)]="maxPairsToReview" 
            (ionChange)="onPairsCountChange()"
            interface="popover"
            placeholder="Sélectionner">
            <ion-select-option value="3">3 paires</ion-select-option>
            <ion-select-option value="4">4 paires</ion-select-option>
            <ion-select-option value="5">5 paires</ion-select-option>
            <ion-select-option value="6">6 paires</ion-select-option>
            <ion-select-option value="8">8 paires</ion-select-option>
            <ion-select-option value="10">10 paires</ion-select-option>
            <ion-select-option value="12">12 paires</ion-select-option>
            <ion-select-option value="15">15 paires</ion-select-option>
            <ion-select-option value="18">18 paires</ion-select-option>
            <ion-select-option value="20">20 paires</ion-select-option>
          </ion-select>
        </ion-item>
      </div>

      <div class="game-info" *ngIf="!gameComplete && currentPairs && currentPairs.length > 0">
        <p>
          <span class="set-indicator">Set {{ currentPairsSet }}/{{ getTotalSets() }}</span>
          <span class="progress-indicator">{{ matchedPairs }} / {{ currentPairs.length / 2 }} paires</span>
        </p>
        <ion-progress-bar [value]="matchedPairs / (currentPairs.length / 2)"></ion-progress-bar>
      </div>
      
      <div class="game-complete" *ngIf="gameComplete">
        <p>Vous avez terminé l'exercice d'association !</p>
        <ion-badge color="success">
          {{ totalPairs }} paires associées | {{ attempts }} tentatives
        </ion-badge>
      </div>
    </div>

    <!-- Grille de jeu -->
    <div class="pairs-grid" *ngIf="!gameComplete && currentPairs && currentPairs.length > 0">
      <ion-grid>
        <ion-row>
          <!-- Colonne de mots sources (à gauche) -->
          <ion-col size="6">
            <div class="source-words">
              <ion-card 
                *ngFor="let pair of currentPairs | filter:'isSource':true" 
                class="word-card" 
                [class]="getCardClass(pair)"
                (click)="selectWord(pair)">
                <ion-card-content>
                  {{ pair.word }}
                </ion-card-content>
              </ion-card>
            </div>
          </ion-col>
          
          <!-- Colonne de mots cibles (à droite) -->
          <ion-col size="6">
            <div class="target-words">
              <ion-card 
                *ngFor="let pair of currentPairs | filter:'isSource':false" 
                class="word-card" 
                [class]="getCardClass(pair)"
                (click)="selectWord(pair)">
                <ion-card-content>
                  {{ pair.word }}
                </ion-card-content>
              </ion-card>
            </div>
          </ion-col>
        </ion-row>
      </ion-grid>
    </div>

    <!-- Message d'erreur s'il n'y a pas de données -->
    <div class="no-data-message" *ngIf="!currentPairs || currentPairs.length === 0">
      <ion-card>
        <ion-card-content class="ion-text-center">
          <ion-icon name="alert-circle-outline" size="large" color="warning"></ion-icon>
          <p>Aucune donnée de jeu disponible.</p>
          <ion-button routerLink="/category" expand="block" color="primary" class="ion-margin-top">
            Retour aux catégories
          </ion-button>
        </ion-card-content>
      </ion-card>
    </div>

    <!-- Section des actions (visible uniquement quand le jeu est terminé) -->
    <div class="actions-section" *ngIf="gameComplete">
      <!-- Section des mots révisés (visible uniquement pour la révision du dictionnaire personnel) -->
      <div class="revised-words-section" *ngIf="isPersonalDictionaryRevision && revisedWords.length > 0">
        <h3 class="ion-text-center">Mots révisés</h3>
        <p class="ion-text-center ion-text-muted">
          <small>Définissez quand ces mots pourront être révisés à nouveau</small>
        </p>
        
        <ion-list>
          <ion-item *ngFor="let word of revisedWords" class="revised-word-item">
            <ion-label>
              <h4>{{ word.sourceWord }} → {{ word.targetWord }}</h4>
              <p *ngIf="word.context" class="word-context">{{ word.context }}</p>
            </ion-label>
            <div class="word-controls">
              <ion-select 
                [(ngModel)]="word.revisionDelay" 
                (ionChange)="onRevisionDelayChange(word)"
                placeholder="Délai"
                interface="popover"
                class="revision-delay-select">
                <ion-select-option value="1j">1 jour</ion-select-option>
                <ion-select-option value="3j">3 jours</ion-select-option>
                <ion-select-option value="7j">7 jours</ion-select-option>
                <ion-select-option value="15j">15 jours</ion-select-option>
                <ion-select-option value="1m">1 mois</ion-select-option>
                <ion-select-option value="3m">3 mois</ion-select-option>
                <ion-select-option value="6m">6 mois</ion-select-option>
              </ion-select>
              <ion-toggle 
                [(ngModel)]="word.isKnown" 
                (ionChange)="onKnownStatusChange(word)"
                class="known-toggle">
                <ion-label>Connu</ion-label>
              </ion-toggle>
            </div>
          </ion-item>
        </ion-list>
        
        <p class="ion-text-center ion-text-muted ion-margin-top">
          <small>Les délais de révision seront sauvegardés automatiquement quand vous quitterez cet écran</small>
        </p>
      </div>

      <!-- Menu principal simplifié -->
      <div class="main-actions">
        <!-- Bouton Plus pour afficher/masquer les options -->
        <ion-button 
          (click)="toggleMoreOptions()" 
          expand="block" 
          fill="outline" 
          class="more-button">
          <ion-icon [name]="showMoreOptions ? 'chevron-up' : 'chevron-down'" slot="end"></ion-icon>
          {{ showMoreOptions ? 'Moins d\'options' : 'Plus d\'options' }}
        </ion-button>
        
        <!-- Options supplémentaires (affichées conditionnellement) -->
        <div class="additional-options" *ngIf="showMoreOptions">
          <!-- Bouton pour ajouter au dictionnaire personnel (masqué si révision du dictionnaire personnel) -->
          <ion-button 
            (click)="openDictionaryModal()" 
            expand="block" 
            fill="outline" 
            class="option-button">
            <ion-icon name="bookmark-outline" slot="start"></ion-icon>
            Ajouter au dictionnaire personnel
          </ion-button>
          
          <!-- Boutons de recommencement -->
          <ion-button (click)="restartExercise()" expand="block" fill="outline" class="option-button">
            <ion-icon name="refresh-outline" slot="start"></ion-icon>
            Recommencer l'exercice
          </ion-button>
          
          <ion-button 
            (click)="restartFailedWords()" 
            expand="block" 
            fill="outline" 
            class="option-button"
            [disabled]="!hasFailedWords">
            <ion-icon name="close-circle-outline" slot="start"></ion-icon>
            Recommencer les mots ratés ({{ failedWords.length }})
          </ion-button>
          
          <ion-button (click)="generateWrittenComprehension()" expand="block" fill="outline" class="option-button" [disabled]="isGenerating">
            <ion-icon name="book-outline" slot="start"></ion-icon>
            Compréhension écrite
          </ion-button>
          
          <ion-button (click)="generateOralComprehension()" expand="block" fill="outline" class="option-button" [disabled]="isGenerating">
            <ion-icon name="mic-outline" slot="start"></ion-icon>
            Compréhension orale
          </ion-button>
          
          <ion-button (click)="goToVocabularyExercise()" expand="block" fill="outline" class="option-button">
            <ion-icon name="create-outline" slot="start"></ion-icon>
            Exercice d'encodage
          </ion-button>
          
          <!-- Indicateur de chargement pour la génération -->
          <div *ngIf="isGenerating" class="loading-container ion-text-center ion-margin-vertical">
            <ion-spinner></ion-spinner>
            <p>Génération du texte en cours...</p>
          </div>
        </div>
        
        <!-- Boutons principaux toujours visibles -->
        <ion-button routerLink="/category" expand="block" fill="outline" class="main-button">
          <ion-icon name="list-outline" slot="start"></ion-icon>
          Retour aux catégories
        </ion-button>
        
        <ion-button routerLink="/home" expand="block" fill="outline" class="main-button">
          <ion-icon name="home-outline" slot="start"></ion-icon>
          Retour à l'accueil
        </ion-button>
      </div>
    </div>
  </div>
</ion-content> 